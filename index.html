<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrambled Word Quiz</title>

    <!-- 1. Tailwind (Design) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Farcaster Embed Metadata -->
    <meta name="fc:miniapp" content='{
      "version":"next",
      "imageUrl":"https://scrambled-word-game1.vercel.app/embed-image.png",
      "button":{
          "title":"Play Scrambled Word Quiz",
          "action":{
          "type":"launch_miniapp",
          "name":"Scrambled Word Quiz",
          "url":"https://scrambled-word-game1.vercel.app/"
          }
      }
    }' />

    <!-- 3. React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- 4. Farcaster SDK (Loaded in module below) -->

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-blue-900">
    <div id="root"></div>

    <script type="module">
        
        // ========= 1. Import l-SDK w n-call-iw Ready() =========
        import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk';
        sdk.actions.ready();
        console.log("Farcaster SDK ready() called immediately.");

        // ========= 2. Setup dyal React w l-Helpers =========
        const { useState, useEffect, createElement } = React;
        
        function parseEther(x){ 
          const [w,f=""] = String(x).split('.'); 
          const frac=(f+'0'.repeat(18)).slice(0,18); 
          return '0x'+(BigInt(w)*10n**18n + BigInt(frac)).toString(16); 
        }
        
        async function getProvider(){ 
          try{ 
            const p = await sdk.wallet.getEthereumProvider(); 
            if (p) return p; 
          } catch(e) {
            console.warn("Error getting Farcaster provider", e);
          } 
          return window.ethereum ?? null; 
        }

        // ========= 3. Components =========
        const Trophy = ({ className }) => {
          // ... (Trophy SVG code kima kan) ...
          return createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24",
            height: "24",
            viewBox: "0 0 24 24",
            fill: "none",
            stroke: "currentColor",
            strokeWidth: "2",
            strokeLinecap: "round",
            strokeLinejoin: "round",
            className: className
          },
            createElement('path', { d: "M6 9H4.5a2.5 2.5 0 0 1 0-5H6" }),
            createElement('path', { d: "M18 9h1.5a2.5 2.5 0 0 0 0-5H18" }),
            createElement('path', { d: "M4 22h16" }),
            createElement('path', { d: "M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" }),
            createElement('path', { d: "M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" }),
            createElement('path', { d: "M18 2H6v7a6 6 0 0 0 12 0V2Z" })
          );
        };

        const wordBank = [
          // ... (L-lista dyal l-klmat kima kant) ...
          { word: 'ELEPHANT', hint: 'Large animal with a trunk' },
          { word: 'COMPUTER', hint: 'Electronic device for work' },
          { word: 'RAINBOW', hint: 'Colorful arc in the sky' },
          { word: 'MOUNTAIN', hint: 'Tall natural elevation' },
          { word: 'BUTTERFLY', hint: 'Colorful flying insect' },
          { word: 'CHOCOLATE', hint: 'Sweet brown treat' },
          { word: 'PIANO', hint: 'Musical instrument with keys' },
          { word: 'TREASURE', hint: 'Hidden valuable items' },
          { word: 'GUITAR', hint: 'Stringed musical instrument' },
          { word: 'DIAMOND', hint: 'Precious gemstone' },
          { word: 'GALAXY', hint: 'System of stars' },
          { word: 'DRAGON', hint: 'Mythical fire-breathing creature' },
          { word: 'CASTLE', hint: 'Medieval fortress' },
          { word: 'PYRAMID', hint: 'Ancient Egyptian structure' },
          { word: 'VOLCANO', hint: 'Mountain that erupts' },
          { word: 'OCEAN', hint: 'Large body of salt water' },
          { word: 'LIBRARY', hint: 'Place with many books' },
          { word: 'ROCKET', hint: 'Spacecraft that flies to space' },
          { word: 'SANDWICH', hint: 'Food between two slices of bread' },
          { word: 'PENGUIN', hint: 'Bird that cannot fly but swims' },
          { word: 'TORNADO', hint: 'Spinning column of air' },
          { word: 'HOSPITAL', hint: 'Place where doctors work' },
          { word: 'BICYCLE', hint: 'Two-wheeled vehicle you pedal' },
          { word: 'TIGER', hint: 'Large striped wild cat' },
          { word: 'WATERFALL', hint: 'Water falling from a height' },
          { word: 'CARNIVAL', hint: 'Festival with rides and games' },
          { word: 'UMBRELLA', hint: 'Keeps you dry in rain' },
          { word: 'TELEPHONE', hint: 'Device for calling people' },
          { word: 'CROCODILE', hint: 'Large reptile in rivers' },
          { word: 'TELESCOPE', hint: 'Device for seeing distant stars' },
          { word: 'FLAMINGO', hint: 'Pink bird that stands on one leg' },
          { word: 'DETECTIVE', hint: 'Person who solves mysteries' },
          { word: 'SKELETON', hint: 'Bones inside your body' },
          { word: 'CHAMPION', hint: 'Winner of a competition' },
          { word: 'KANGAROO', hint: 'Jumping animal from Australia' },
          { word: 'DINOSAUR', hint: 'Extinct prehistoric reptile' },
          { word: 'SUBMARINE', hint: 'Vessel that travels underwater' },
          { word: 'KEYBOARD', hint: 'Device with letters for typing' },
          { word: 'MYSTERY', hint: 'Something hard to understand' },
          { word: 'STADIUM', hint: 'Large sports arena' },
          { word: 'PARACHUTE', hint: 'Slows your fall from the sky' },
          { word: 'PEACOCK', hint: 'Bird with colorful tail feathers' },
          { word: 'MAGICIAN', hint: 'Performer who does tricks' },
          { word: 'CALENDAR', hint: 'Shows days and months' },
          { word: 'PLATYPUS', hint: 'Egg-laying mammal with a bill' },
          { word: 'NECKLACE', hint: 'Jewelry worn around the neck' },
          { word: 'BLIZZARD', hint: 'Heavy snowstorm' },
          { word: 'COMPASS', hint: 'Shows directions like north' },
          { word: 'GORILLA', hint: 'Large strong ape' }
        ];

        const ROUND_LIMIT = 5;
        const GAME_FEE_ETH = '0.0001';
        const DEVELOPER_WALLET = '0x68c71247712E39925d31d82FdC02dfe0f8e24de7';

        // ========= 4. L-APP L-RA'ISSI =========
        function App() {
          const [gameState, setGameState] = useState('home');
          const [currentWord, setCurrentWord] = useState(null);
          const [scrambled, setScrambled] = useState('');
          const [userGuess, setUserGuess] = useState('');
          const [score, setScore] = useState(0);
          const [attempts, setAttempts] = useState(0);
          const [feedback, setFeedback] = useState('');
          const [usedWords, setUsedWords] = useState([]);
          const [timer, setTimer] = useState(20);
          const [round, setRound] = useState(0);
          
          const [statusMessage, setStatusMessage] = useState('');
          const [isProcessing, setIsProcessing] = useState(false);
          const [fid, setFid] = useState(null); 
          const [userAddress, setUserAddress] = useState(null);

          // ... (L-functions dyal l-wallet w l-game kima kano) ...
          
          const handleConnectWallet = async () => {
            setIsProcessing(true);
            setStatusMessage('1/2: Connecting to Farcaster...');
            
            // Check if connect function exists
             if (!sdk || !sdk.wallet || typeof sdk.wallet.connect !== 'function') {
                setStatusMessage('❌ Error: Wallet connect function not available. Please ensure you are in a Farcaster client.');
                setIsProcessing(false);
                return;
            }

            try {
              const { fid: userFid, address } = await sdk.wallet.connect(); 
              if (userFid) {
                setFid(userFid);
                setUserAddress(address); 
                setStatusMessage(`✅ Connected! FID: ${userFid}`);
              } else {
                setStatusMessage('❌ Connection failed. Please try again.');
              }
            } catch (e) {
              console.error('Connection error:', e);
              setStatusMessage(`❌ Error: ${e.message}`);
            }
            setIsProcessing(false);
          };

          const handleStartGame = async () => {
            if (!userAddress) {
              setStatusMessage('Please connect your wallet first.');
              return;
            }
            
            if (DEVELOPER_WALLET === '0x...YOUR_WALLET_ADDRESS_HERE...' || DEVELOPER_WALLET.length < 42) {
                setStatusMessage('⚠️ Developer: Please set your wallet address in the code!');
                setIsProcessing(false);
                return;
            }
            
            setIsProcessing(true);
            setStatusMessage('1/3: Locating wallet provider...');

            try {
              const provider = await getProvider();
              if (!provider) {
                throw new Error('No wallet provider found.');
              }
              setStatusMessage('2/3: Please approve the payment in your wallet...');

              const hash = await provider.request({
                method: 'eth_sendTransaction',
                params: [{
                  from: userAddress, 
                  to: DEVELOPER_WALLET, 
                  value: parseEther(GAME_FEE_ETH), 
                }]
              });
              
              setStatusMessage('✅ Payment complete! Starting game...');
              console.log("Transaction Hash:", hash);
              
              setTimeout(() => {
                setGameState('playing');
                setIsProcessing(false);
                setStatusMessage('');
              }, 1500);

            } catch (e) {
              console.error('Payment error:', e);
              setStatusMessage(`❌ Payment failed: ${e.message.split('.')[0]}.`);
              setIsProcessing(false);
            }
          };
          
          const scrambleWord = (word) => {
            const firstLetter = word[0];
            const remainingLetters = word.slice(1).split('');
            for (let i = remainingLetters.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [remainingLetters[i], remainingLetters[j]] = [remainingLetters[j], remainingLetters[i]];
            }
            const scrambledWordResult = firstLetter + remainingLetters.join('');
            return scrambledWordResult === word ? scrambleWord(word) : scrambledWordResult;
          };

          const loadNewWord = () => {
            const nextRound = round + 1;
            if (nextRound > ROUND_LIMIT) {
              setGameState('gameover');
              return;
            }
            let wordsPool = usedWords;
            if (usedWords.length === wordBank.length) {
              wordsPool = [];
            }
            const availableWords = wordBank.filter(w => !wordsPool.includes(w.word));
            const randomWord = availableWords[Math.floor(Math.random() * availableWords.length)];
            setCurrentWord(randomWord);
            setScrambled(scrambleWord(randomWord.word));
            setUserGuess('');
            setFeedback('');
            setTimer(20);
            setUsedWords([...wordsPool, randomWord.word]);
            setRound(nextRound);
          };

          useEffect(() => {
            if (gameState === 'playing' && round === 0) {
              loadNewWord();
            }
          }, [gameState]);

          useEffect(() => {
            if (gameState !== 'playing' || timer <= 0) {
              return;
            }
            const interval = setInterval(() => {
              setTimer(t => t - 1);
            }, 1000);
            return () => clearInterval(interval);
          }, [gameState, timer]);

          useEffect(() => {
            if (timer === 0 && gameState === 'playing' && currentWord) {
              setFeedback(`Time's up! The word was: ${currentWord.word}`);
              setAttempts(attempts + 1);
              setTimeout(() => {
                loadNewWord();
              }, 2000);
            }
          }, [timer, gameState]);

          const handleSubmit = () => {
            if (timer === 0 || !currentWord) return;
            if (userGuess.toUpperCase() === currentWord.word) {
              setScore(score + 100);
              setFeedback('🎉 Correct! Well done!');
              setTimeout(() => {
                loadNewWord();
              }, 1500);
            } else {
              setFeedback('❌ Try again!');
            }
            setAttempts(attempts + 1);
          };

          const handleSkip = () => {
            if (timer === 0 || !currentWord) return;
            setFeedback(`The word was: ${currentWord.word}`);
            setAttempts(attempts + 1);
            setTimeout(() => {
              loadNewWord();
            }, 2000);
          };

          const handleKeyPress = (e) => {
            if (e.key === 'Enter') {
              handleSubmit();
            }
          };

          const handleRestartGame = () => {
            setScore(0);
            setAttempts(0);
            setUsedWords([]);
            setRound(0);
            setFid(null); 
            setUserAddress(null);
            setGameState('home');
            setStatusMessage('');
          };


          // ========= 5. L-INTERFACE =========
          if (gameState === 'home') {
            return createElement('div', { className: "min-h-screen bg-gradient-to-b from-blue-900 via-blue-800 to-blue-900 flex items-center justify-center p-4 text-white" },
              createElement('div', { className: "text-center w-full max-w-lg" },
                createElement('h1', { className: "text-5xl md:text-6xl font-black mb-4", style: { textShadow: '4px 4px 0px rgba(0,0,0,0.3)', WebkitTextStroke: '2px #FF1493' } },
                  'GUESS',
                  createElement('span', { className: "ml-3", style: { color: '#00FFFF' } }, 'THE WORD!')
                ),
                // HNA 7YDNA L-JUMLA
                createElement('h2', { className: "text-xl md:text-2xl text-cyan-300 mb-8" },
                  `` // Khllinaha khawia
                ),
                createElement('div', { className: "flex flex-col gap-4 w-full" },
                  createElement('button', {
                    onClick: handleConnectWallet,
                    disabled: isProcessing || fid,
                    className: "bg-purple-600 text-white px-8 py-4 rounded-xl font-black text-xl border-4 border-white shadow-lg hover:bg-purple-700 transition transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                  }, fid ? `✅ Connected (FID: ${fid})` : '1. Connect Farcaster Wallet'),
                  createElement('button', {
                    onClick: handleStartGame,
                    disabled: !fid || isProcessing,
                    className: "bg-pink-500 text-white px-8 py-4 rounded-xl font-black text-xl border-4 border-white shadow-lg hover:bg-pink-600 transition transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                  }, isProcessing ? statusMessage : `2. Start Game (Pay ${GAME_FEE_ETH} ETH)`)
                ),
                statusMessage && !isProcessing && createElement('div', {
                  className: `mt-6 p-4 rounded-lg font-bold ${
                    statusMessage.includes('Error') || statusMessage.includes('failed') || statusMessage.includes('⚠️') || statusMessage.includes('❌')
                      ? 'bg-red-500/80' 
                      : statusMessage.includes('✅')
                      ? 'bg-green-500/80'
                      : 'bg-blue-500/80'
                  }`
                }, statusMessage),
                createElement('div', { className: "mt-8 text-sm text-cyan-200 opacity-75" },
                  createElement('p', null, '🎮 Unscramble words to score points'),
                  createElement('p', null, '⏱️ 20 seconds per word'),
                  createElement('p', null, '🏆 100 points per correct answer')
                )
              )
            );
          }

          // ... (L-code dyal 'gameover' w 'playing' kima kan) ...
          
           if (gameState === 'gameover') {
            return createElement('div', { className: "min-h-screen bg-gradient-to-b from-blue-900 via-blue-800 to-blue-900 flex items-center justify-center p-4 text-white" },
              createElement('div', { className: "text-center bg-blue-700 p-8 md:p-10 rounded-2xl border-4 border-cyan-400 shadow-2xl max-w-lg" },
                createElement(Trophy, { className: "w-16 h-16 mx-auto mb-4 text-yellow-400" }),
                createElement('h1', { className: "text-4xl md:text-5xl font-black mb-4 text-cyan-300" }, 'GAME OVER!'),
                createElement('div', { className: "text-2xl md:text-3xl mb-2" }, 'Final Score:'),
                createElement('div', { className: "text-5xl md:text-6xl font-black text-pink-400 mb-6" }, score),
                createElement('div', { className: "text-lg mb-8 text-cyan-200" }, `You completed ${ROUND_LIMIT} rounds!`),
                createElement('button', {
                  onClick: handleRestartGame,
                  className: "bg-pink-500 text-white px-10 py-5 rounded-xl font-black text-2xl border-4 border-white shadow-lg hover:bg-pink-600 transition transform hover:scale-105"
                }, 'Play Again (Pay Fee)')
              )
            );
          }

          if (!currentWord) {
            return createElement('div', { className: "min-h-screen bg-blue-900 flex items-center justify-center text-white text-2xl" }, 'Loading...');
          }

          return createElement('div', { className: "min-h-screen bg-gradient-to-b from-blue-900 via-blue-800 to-blue-900 flex items-center justify-center p-4" },
            createElement('div', { className: "w-full max-w-4xl" },
              createElement('div', { className: "text-center mb-6" },
                createElement('h1', { className: "text-4xl md:text-6xl font-black mb-2", style: { textShadow: '4px 4px 0px rgba(0,0,0,0.3)', color: 'white', WebkitTextStroke: '2px #FF1493' } },
                  'GUESS',
                  createElement('span', { className: "ml-3", style: { color: '#00FFFF' } }, 'THE WORD!')
                )
              ),
              createElement('div', { className: "flex justify-center gap-3 mb-6 flex-wrap" },
                createElement('div', { className: "bg-pink-500 px-4 py-2 md:px-6 md:py-3 rounded-lg border-4 border-white shadow-lg" },
                  createElement('div', { className: "text-white font-bold text-xs md:text-sm" }, 'SCORE'),
                  createElement('div', { className: "text-2xl md:text-3xl font-black text-white flex items-center justify-center gap-1" },
                    createElement(Trophy, { className: "w-5 h-5 md:w-6 md:h-6" }),
                    score
                  )
                ),
                createElement('div', { className: "bg-cyan-400 px-4 py-2 md:px-6 md:py-3 rounded-lg border-4 border-white shadow-lg" },
                  createElement('div', { className: "text-blue-900 font-bold text-xs md:text-sm" }, 'ROUND'),
                  createElement('div', { className: "text-2xl md:text-3xl font-black text-blue-900" }, `${round} / ${ROUND_LIMIT}`)
                ),
                createElement('div', { className: `px-4 py-2 md:px-6 md:py-3 rounded-lg border-4 border-white shadow-lg ${timer <= 5 ? 'bg-red-500' : 'bg-yellow-400'}` },
                  createElement('div', { className: `font-bold text-xs md:text-sm ${timer <= 5 ? 'text-white' : 'text-blue-900'}` }, 'TIME'),
                  createElement('div', { className: `text-2xl md:text-3xl font-black ${timer <= 5 ? 'text-white' : 'text-blue-900'}` }, `${timer}s`)
                )
              ),
              createElement('div', { className: "bg-gradient-to-b from-blue-700 to-blue-800 rounded-3xl p-6 md:p-8 border-8 border-cyan-400 shadow-2xl" },
                createElement('div', { className: "text-center mb-6" },
                  createElement('div', { className: "inline-block bg-pink-500 px-4 py-2 md:px-6 md:py-3 rounded-full border-4 border-white" },
                    createElement('div', { className: "text-white font-bold text-base md:text-lg" }, `💡 ${currentWord.hint}`)
                  )
                ),
                createElement('div', { className: "flex justify-center gap-1 md:gap-2 mb-6 flex-wrap" },
                  ...scrambled.split('').map((letter, i) =>
                    createElement('div', {
                      key: i,
                      className: "w-12 h-12 md:w-16 md:h-16 bg-white rounded-lg border-4 flex items-center justify-center shadow-lg transform hover:scale-105 transition",
                      style: { borderColor: i === 0 ? '#00FF00' : '#FF1493' }
                    },
                      createElement('span', { className: "text-2xl md:text-4xl font-black", style: { color: i === 0 ? '#00FF00' : '#003366' } }, letter)
                    )
                  )
                ),
                createElement('div', { className: "max-w-md mx-auto mb-4" },
                  createElement('input', {
                    type: "text",
                    value: userGuess,
                    onChange: (e) => setUserGuess(e.target.value),
                    onKeyPress: handleKeyPress,
                    placeholder: "TYPE YOUR ANSWER...",
                    className: "w-full px-4 py-3 md:px-6 md:py-4 text-xl md:text-2xl font-bold text-center uppercase rounded-xl border-4 border-pink-500 focus:outline-none focus:border-cyan-400 shadow-lg",
                    style: { backgroundColor: '#FFFFFF', color: '#003366' },
                    autoFocus: true,
                    disabled: timer === 0
                  })
                ),
                createElement('div', { className: "flex justify-center gap-3 md:gap-4" },
                  createElement('button', {
                    onClick: handleSubmit,
                    disabled: timer === 0,
                    className: "bg-pink-500 text-white px-6 py-3 md:px-8 md:py-4 rounded-xl font-black text-lg md:text-xl border-4 border-white shadow-lg hover:bg-pink-600 transition transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                  }, 'SUBMIT'),
                  createElement('button', {
                    onClick: handleSkip,
                    disabled: timer === 0,
                    className: "bg-cyan-400 text-blue-900 px-6 py-3 md:px-8 md:py-4 rounded-xl font-black text-lg md:text-xl border-4 border-white shadow-lg hover:bg-cyan-500 transition transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                  }, 'SKIP')
                ),
                feedback && createElement('div', {
                  className: `mt-6 p-4 rounded-xl text-center font-black text-lg md:text-xl border-4 border-white shadow-lg ${
                    feedback.includes('Correct') 
                      ? 'bg-green-400 text-white' 
                      : feedback.includes('Try again')
                      ? 'bg-red-500 text-white'
                      : 'bg-yellow-400 text-blue-900'
                  }`
                }, feedback)
              )
            )
          );
        }

        // ========= 6. Render l-App =========
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(createElement(App));

    </script>
</body>
</html>

